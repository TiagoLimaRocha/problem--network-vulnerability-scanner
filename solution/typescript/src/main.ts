import { ScanService } from "./scan/scan.service";
import { AssetTypeEnum } from "./scan/scan.types";

async function main() {
  const scanner = new ScanService();
  const promises = Object.values(AssetTypeEnum).map((assetType) => scanner.scan(assetType));

  const errors: Error[] = [];
  const results = await Promise.allSettled(promises).then((results) => {
    const rejected = results.filter((result) => result.status === 'rejected');
    rejected.forEach(({ reason }: any) => errors.push(reason));
    return scanner.processScanResults(new Date());
  });

  console.log({ results, errors });
}
main();
